import React, { useState, useRef, useEffect } from 'react';\nimport { useMessages } from '../../hooks/useMessaging';\nimport { useAuth } from '../../contexts/AuthContext';\nimport { Message } from '../../lib/types';\n\ninterface MessagingChatProps {\n  organizationId: string;\n}\n\nconst MessagingChat: React.FC<MessagingChatProps> = ({ organizationId }) => {\n  const { user } = useAuth();\n  const { messages, loading, sendMessage, editMessage, deleteMessage } = useMessages(organizationId);\n  const [newMessage, setNewMessage] = useState('');\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editContent, setEditContent] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n\n  const handleSendMessage = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!newMessage.trim() || !user) return;\n\n    try {\n      await sendMessage(newMessage, user.uid, user.displayName || user.email || 'Unknown');\n      setNewMessage('');\n    } catch (error) {\n      console.error('Failed to send message:', error);\n    }\n  };\n\n  const handleEditMessage = async (messageId: string) => {\n    if (!editContent.trim()) return;\n\n    try {\n      await editMessage(messageId, editContent);\n      setEditingId(null);\n      setEditContent('');\n    } catch (error) {\n      console.error('Failed to edit message:', error);\n    }\n  };\n\n  const handleDeleteMessage = async (messageId: string) => {\n    if (!confirm('Are you sure you want to delete this message?')) return;\n\n    try {\n      await deleteMessage(messageId);\n    } catch (error) {\n      console.error('Failed to delete message:', error);\n    }\n  };\n\n  const startEditing = (message: Message) => {\n    setEditingId(message.id);\n    setEditContent(message.content);\n  };\n\n  const formatTime = (date: Date) => {\n    return new Intl.DateTimeFormat('en-US', {\n      hour: '2-digit',\n      minute: '2-digit',\n      hour12: true\n    }).format(date);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex flex-col h-96 bg-white rounded-lg shadow-md\">\n      {/* Header */}\n      <div className=\"bg-blue-600 text-white p-4 rounded-t-lg\">\n        <h3 className=\"text-lg font-semibold\">Team Chat</h3>\n      </div>\n\n      {/* Messages */}\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {messages.length === 0 ? (\n          <div className=\"text-center text-gray-500 py-8\">\n            No messages yet. Start the conversation!\n          </div>\n        ) : (\n          messages.map((message) => (\n            <div\n              key={message.id}\n              className={`flex ${message.senderId === user?.uid ? 'justify-end' : 'justify-start'}`}\n            >\n              <div\n                className={`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${\n                  message.senderId === user?.uid\n                    ? 'bg-blue-600 text-white'\n                    : 'bg-gray-200 text-gray-800'\n                }`}\n              >\n                {message.senderId !== user?.uid && (\n                  <div className=\"text-xs font-semibold mb-1\">\n                    {message.senderName}\n                  </div>\n                )}\n                \n                {editingId === message.id ? (\n                  <div className=\"space-y-2\">\n                    <input\n                      type=\"text\"\n                      value={editContent}\n                      onChange={(e) => setEditContent(e.target.value)}\n                      className=\"w-full px-2 py-1 text-sm border rounded text-gray-800\"\n                      onKeyPress={(e) => {\n                        if (e.key === 'Enter') {\n                          handleEditMessage(message.id);\n                        }\n                      }}\n                    />\n                    <div className=\"flex space-x-2\">\n                      <button\n                        onClick={() => handleEditMessage(message.id)}\n                        className=\"text-xs bg-green-500 text-white px-2 py-1 rounded\"\n                      >\n                        Save\n                      </button>\n                      <button\n                        onClick={() => setEditingId(null)}\n                        className=\"text-xs bg-gray-500 text-white px-2 py-1 rounded\"\n                      >\n                        Cancel\n                      </button>\n                    </div>\n                  </div>\n                ) : (\n                  <>\n                    <div className=\"text-sm\">{message.content}</div>\n                    {message.edited && (\n                      <div className=\"text-xs opacity-75 mt-1\">(edited)</div>\n                    )}\n                  </>\n                )}\n                \n                <div className=\"flex items-center justify-between mt-1\">\n                  <div className=\"text-xs opacity-75\">\n                    {formatTime(message.timestamp)}\n                  </div>\n                  \n                  {message.senderId === user?.uid && editingId !== message.id && (\n                    <div className=\"flex space-x-1 ml-2\">\n                      <button\n                        onClick={() => startEditing(message)}\n                        className=\"text-xs opacity-75 hover:opacity-100\"\n                      >\n                        Edit\n                      </button>\n                      <button\n                        onClick={() => handleDeleteMessage(message.id)}\n                        className=\"text-xs opacity-75 hover:opacity-100\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                  )}\n                </div>\n              </div>\n            </div>\n          ))\n        )}\n        <div ref={messagesEndRef} />\n      </div>\n\n      {/* Message Input */}\n      <form onSubmit={handleSendMessage} className=\"p-4 border-t\">\n        <div className=\"flex space-x-2\">\n          <input\n            type=\"text\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            placeholder=\"Type your message...\"\n            className=\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          />\n          <button\n            type=\"submit\"\n            disabled={!newMessage.trim()}\n            className=\"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            Send\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default MessagingChat;