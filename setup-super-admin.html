<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Super Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        button {
            background: #4285f4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }

        button:hover {
            background: #3367d6;
        }

        .output {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }

        .error {
            color: red;
        }

        .success {
            color: green;
        }

        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <h1>Setup Super Admin</h1>

    <div class="section">
        <h2>Super Admin Credentials</h2>
        <input type="email" id="adminEmail" placeholder="Super Admin Email" value="reycelrcentino@gmail.com">
        <input type="password" id="adminPassword" placeholder="Super Admin Password" value="kNooCkk@0228a">
        <button onclick="createSuperAdmin()">Create Super Admin</button>
    </div>

    <div class="section">
        <h2>Output</h2>
        <div id="output" class="output">Click "Create Super Admin" to setup the system...</div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDy4jBqxKpD_B6SGAqRLyTrmGxQ9rEA0zw",
            authDomain: "officeofmapp.firebaseapp.com",
            projectId: "officeofmapp",
            storageBucket: "officeofmapp.firebasestorage.app",
            messagingSenderId: "710263745328",
            appId: "1:710263745328:web:a41ed7f9f6df52970db6f5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
            console.log(message);
        }

        window.createSuperAdmin = async function () {
            log('=== Creating Super Admin ===');

            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (!email || !password) {
                log('Please enter email and password', 'error');
                return;
            }

            try {
                // Check if super admin already exists
                log('Checking if super admin already exists...');
                const q = query(collection(db, 'users'), where('role', '==', 'super_admin'));
                const snapshot = await getDocs(q);

                if (!snapshot.empty) {
                    log('✅ Super admin already exists!', 'success');
                    snapshot.forEach(doc => {
                        const data = doc.data();
                        log(`Existing super admin: ${data.email}`);
                    });
                    return;
                }

                // Create super admin account
                log('Creating super admin account...');
                const result = await createUserWithEmailAndPassword(auth, email, password);
                log(`✅ Firebase Auth account created: ${result.user.email}`);

                // Create user profile
                const profile = {
                    uid: result.user.uid,
                    email: email,
                    role: 'super_admin',
                    name: 'Super Administrator',
                    createdAt: new Date(),
                    lastLogin: new Date()
                };

                await setDoc(doc(db, 'users', result.user.uid), profile);
                log('✅ User profile created in Firestore');

                log('✅ Super admin setup complete!', 'success');
                log('You can now sign in to the main app with these credentials.');

            } catch (error) {
                log(`❌ Error creating super admin: ${error.message}`, 'error');

                if (error.code === 'auth/email-already-in-use') {
                    log('Email already in use. Trying to sign in and create profile...', 'error');

                    try {
                        const signInResult = await signInWithEmailAndPassword(auth, email, password);
                        log('✅ Signed in with existing account');

                        // Create profile if it doesn't exist
                        const profile = {
                            uid: signInResult.user.uid,
                            email: email,
                            role: 'super_admin',
                            name: 'Super Administrator',
                            createdAt: new Date(),
                            lastLogin: new Date()
                        };

                        await setDoc(doc(db, 'users', signInResult.user.uid), profile);
                        log('✅ User profile created for existing account');
                        log('✅ Super admin setup complete!', 'success');

                    } catch (signInError) {
                        log(`❌ Sign in failed: ${signInError.message}`, 'error');
                    }
                }
            }
        };
    </script>
</body>

</html>